Copyright 2021 Transmutex SA -- all rights reserved

Author \+: Thomas Guilbaud ~\newline
 Date \+: 4th May 2021 ~\newline
 Updated\+: 9th June 2021\hypertarget{md___users__transmutex__simulation__a_d_s__simulation_code__benchmark_3_src_lattice_map__r_e_a_d_m_e_autotoc_md17}{}\doxysection{Structure}\label{md___users__transmutex__simulation__a_d_s__simulation_code__benchmark_3_src_lattice_map__r_e_a_d_m_e_autotoc_md17}
\hypertarget{md___users__transmutex__simulation__a_d_s__simulation_code__benchmark_3_src_lattice_map__r_e_a_d_m_e_autotoc_md18}{}\doxysubsection{General Use}\label{md___users__transmutex__simulation__a_d_s__simulation_code__benchmark_3_src_lattice_map__r_e_a_d_m_e_autotoc_md18}
Each lattice must be written in square shape map. The first row must include the lattice type. The second row must include x and y limits. For example, a symmetric lattice centered to (0,0) could look like this\+: {\ttfamily -\/2 2 -\/2 2}. It is also possible to include the pitch of the lattice by adding a number and its unit (ex\+: {\ttfamily -\/2 5 -\/3 3 5 cm}). It is important to separate the elements by at least one space.

The next rows includes the structure of the lattice. Each assembly must be separated by at least one space. The number of rows and columns must corresponds to the lattice limits given in the first line. The example above must have a square of 5 rows and 5 columns. To fill the gaps, one can use the number {\ttfamily 0} and no assembly will be placed.

To help writing an hexagonal shape lattice, one can place spaces before the rows (see the example below).\hypertarget{md___users__transmutex__simulation__a_d_s__simulation_code__benchmark_3_src_lattice_map__r_e_a_d_m_e_autotoc_md19}{}\doxysubsection{Special Use}\label{md___users__transmutex__simulation__a_d_s__simulation_code__benchmark_3_src_lattice_map__r_e_a_d_m_e_autotoc_md19}
With \mbox{\hyperlink{class_t_m_x_lattice}{TMXLattice}}, it is possible to add a special value to the assembly ({\ttfamily add\+Daughter\+Action}). For example, if an element in the lattice map is written like {\ttfamily FA\+:100}, the callback function given with {\ttfamily add\+Daughter\+Action} will be called and the value {\ttfamily 100} will be pass in this callback function. It can be use for changing parameter like the insertion of a control rod, a change in temperature, a new material, ...

If a few element have the same {\ttfamily id}, the same callback function will be applied on each of these elements. If a few element have the same {\ttfamily id} and a action parameter, the callback function will be called and it might create some confusion. It is recommanded to apply an action once for each element id type.\hypertarget{md___users__transmutex__simulation__a_d_s__simulation_code__benchmark_3_src_lattice_map__r_e_a_d_m_e_autotoc_md20}{}\doxysection{Syntax}\label{md___users__transmutex__simulation__a_d_s__simulation_code__benchmark_3_src_lattice_map__r_e_a_d_m_e_autotoc_md20}

\begin{DoxyItemize}
\item Lattice Type\+:
\begin{DoxyItemize}
\item {\ttfamily Hexagonal}
\item {\ttfamily Square}
\end{DoxyItemize}
\item Pitch\+:
\begin{DoxyItemize}
\item {\ttfamily Number Unit}
\item Units allowed\+: nm, um, mm, cm, dm, m
\item {\bfseries{Important}}\+: if a pitch is given in the map file, it will overwrite the value set in the code.
\end{DoxyItemize}
\item With \mbox{\hyperlink{class_t_m_x_lattice}{TMXLattice}}\+: ~\newline

\begin{DoxyItemize}
\item {\ttfamily 0} = void, no assembly
\item {\ttfamily any\+Name} = assembly (use {\ttfamily add\+Daughter\+Volume(\char`\"{}any\+Name\char`\"{}, assembly\+Volume)} to add an element with reference {\itshape any\+Name})
\item {\ttfamily any\+Name\+:number} = assembly with a special value. The {\ttfamily \+:} must be used to separate without space between (use {\ttfamily add\+Daughter\+Action(\char`\"{}id\char`\"{}, std\+::bind(\&class\+::member, obj, \+\_\+1))})
\item {\ttfamily //} to add comments
\end{DoxyItemize}
\end{DoxyItemize}\hypertarget{md___users__transmutex__simulation__a_d_s__simulation_code__benchmark_3_src_lattice_map__r_e_a_d_m_e_autotoc_md21}{}\doxysection{Simple example\+: Square Lattice}\label{md___users__transmutex__simulation__a_d_s__simulation_code__benchmark_3_src_lattice_map__r_e_a_d_m_e_autotoc_md21}
This lattice is made in a 5x5 square with a pitch of 15 mm. The center of the lattice is (0, 0).


\begin{DoxyCode}{0}
\DoxyCodeLine{Square  }
\DoxyCodeLine{-\/2 2   -\/2 2  15 mm  // Shape limits and pitch}
\DoxyCodeLine{0 0 0 0 0           // y=-\/2 ; x=[-\/2; 2]}
\DoxyCodeLine{0 0 F 0 0           // y=-\/1 ; x=[-\/2; 2]}
\DoxyCodeLine{0 F F F 0           // y= 0 ; x=[-\/2; 2]}
\DoxyCodeLine{0 0 F 0 0           // y= 1 ; x=[-\/2; 2]}
\DoxyCodeLine{0 0 0 0 0           // y= 2 ; x=[-\/2; 2]}

\end{DoxyCode}
\hypertarget{md___users__transmutex__simulation__a_d_s__simulation_code__benchmark_3_src_lattice_map__r_e_a_d_m_e_autotoc_md22}{}\doxysection{Hexagonal Lattice with numbers}\label{md___users__transmutex__simulation__a_d_s__simulation_code__benchmark_3_src_lattice_map__r_e_a_d_m_e_autotoc_md22}
This lattice is made in a 5x5 square. The center of the lattice is (-\/1, 2). Here one element has an action ({\ttfamily F\+:1}). This action will be applied on each {\ttfamily F} element once. It is recommended to write this action once to avoid any error.


\begin{DoxyCode}{0}
\DoxyCodeLine{Hexagonal  }
\DoxyCodeLine{-\/3 1   0 4                  // Shape limits  }
\DoxyCodeLine{0   0   0   0   0           // y=0 ; x=[-\/3; 1]}
\DoxyCodeLine{  0   0   F   F   0         // y=1 ; x=[-\/3; 1]}
\DoxyCodeLine{    0   F   F:1 F   0       // y=2 ; x=[-\/3; 1]}
\DoxyCodeLine{      0   F   F   0   0     // y=3 ; x=[-\/3; 1]}
\DoxyCodeLine{        0   0   0   0   0   // y=4 ; x=[-\/3; 1]}

\end{DoxyCode}
\hypertarget{md___users__transmutex__simulation__a_d_s__simulation_code__benchmark_3_src_lattice_map__r_e_a_d_m_e_autotoc_md23}{}\doxysection{How to use TMXLattice}\label{md___users__transmutex__simulation__a_d_s__simulation_code__benchmark_3_src_lattice_map__r_e_a_d_m_e_autotoc_md23}
First declare the \mbox{\hyperlink{class_t_m_x_lattice}{TMXLattice}} object the following argument\+:

\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{3}{|X[-1]}|}
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Argument   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Member   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Description    }\\\cline{1-3}
\endfirsthead
\hline
\endfoot
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Argument   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Member   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Description    }\\\cline{1-3}
\endhead
Pitch   &{\ttfamily set\+Pitch(double)}   &Set the picth between elements. Optional if the pitch is given in the map file    \\\cline{1-3}
Element Rotation   &{\ttfamily set\+Element\+Rotation(\+G4\+Rotation\+Matrix$\ast$)}   &{\bfseries{Optional}}   \\\cline{1-3}
\end{longtabu}
$\vert$ Lattice Map $\vert$ {\ttfamily set\+Lattice\+Map(std\+::string filepath)} $\vert$ $\vert$ Add Daughter Volume $\vert$ {\ttfamily add\+Daughter\+Volume(\char`\"{}id\char`\"{}, G4\+Logical\+Volume$\ast$)} $\vert$ Add a new element, {\ttfamily id} must the same used in the lattice map $\vert$ $\vert$ Add Daughter Action $\vert$ {\ttfamily add\+Daughter\+Action(\char`\"{}id\char`\"{}, std\+::function\texorpdfstring{$<$}{<}void(double)\texorpdfstring{$>$}{>} action)} $\vert$ ({\bfseries{Optional}}) Add a special callback function when an element is written with a number (for example\+: FA\+:100) \mbox{[}\href{https://stackoverflow.com/questions/12662891/how-can-i-pass-a-member-function-where-a-free-function-is-expected}{\texttt{ 1}}\mbox{]}. Example\+: {\ttfamily m\+\_\+core\+Lattice-\/\texorpdfstring{$>$}{>}add\+Daughter\+Action(\char`\"{}\+CR\char`\"{}, std\+::bind(\&\+SVBR100\+\_\+\+Fuel\+Assembly\+::place\+Control\+Rod, m\+\_\+fuel\+Assembly, \+\_\+1));} from {\ttfamily SVBR100\+\_\+\+Fuel\+Assembly.\+cc} because {\ttfamily place\+Control\+Rod} is a member function of {\ttfamily \mbox{\hyperlink{class_s_v_b_r100___fuel_assembly}{SVBR100\+\_\+\+Fuel\+Assembly}}} $\vert$ $\vert$ Mother Volume $\vert$ {\ttfamily set\+Mother\+Volume(\+G4\+Logical\+Volume$\ast$)} $\vert$ The volume in which the element lust be placed $\vert$ $\vert$ Element Translation $\vert$ {\ttfamily set\+Element\+Translation(\+G4\+Three\+Vector)} $\vert$ {\bfseries{Optional}} $\vert$ $\vert$ Lattice Placement $\vert$ {\ttfamily place\+Lattice(bool overlap)} $\vert$ Build the lattice $\vert$ 