\hypertarget{xntimp_8_f_source}{}\doxysection{xntimp.\+F}
\label{xntimp_8_f_source}\index{/Users/Transmutex/Simulation/ADS\_SimulationCode/xnsect/xnsect/src/xntimp.F@{/Users/Transmutex/Simulation/ADS\_SimulationCode/xnsect/xnsect/src/xntimp.F}}

\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00001}00001 \textcolor{comment}{*CMZ :          28/08/97  18.27.17  by  Federico Carminati}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00002}00002 \textcolor{comment}{*-\/-\/ Author :    Federico Carminati   22/08/97}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00003}00003       \textcolor{keyword}{SUBROUTINE }xntimp(IZAMAT,ITEMP,LTEMPE,NTEMP,IPMAT)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00004}00004 \textcolor{comment}{************************************************************************}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00005}00005 \textcolor{comment}{*                                                                      *}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00006}00006 \textcolor{comment}{*     This subroutine interpolates the cross sections at two different *}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00007}00007 \textcolor{comment}{*     temperatures to obtain the specified temperature.                *}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00008}00008 \textcolor{comment}{*                                                                      *}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00009}00009 \textcolor{comment}{*     IZAMAT    (input) material code                                  *}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00010}00010 \textcolor{comment}{*                                                                      *}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00011}00011 \textcolor{comment}{*     ITEMP     (input) temperature requested in degrees K             *}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00012}00012 \textcolor{comment}{*                                                                      *}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00013}00013 \textcolor{comment}{*     LTEMPE    (input) list of temperatures available, it is the      *}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00014}00014 \textcolor{comment}{*               responsibility of the user to make sure that they are  *}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00015}00015 \textcolor{comment}{*               really there.                                          *}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00016}00016 \textcolor{comment}{*                                                                      *}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00017}00017 \textcolor{comment}{*     NTEMP     (input) number of temperatures available               *}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00018}00018 \textcolor{comment}{*                                                                      *}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00019}00019 \textcolor{comment}{*     IPMAT     (output) pointer to the material                       *}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00020}00020 \textcolor{comment}{*                                                                      *}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00021}00021 \textcolor{comment}{************************************************************************}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00022}00022 \textcolor{comment}{*}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00023}00023 \textcolor{comment}{* Externals \& Globals}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00024}00024       dimension ltempe(ntemp)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00025}00025 \textcolor{preprocessor}{\#include "{}xcmxse.inc"{}}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00026}00026 \textcolor{preprocessor}{}\textcolor{preprocessor}{\#include "{}xcpoin.inc"{}}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00027}00027 \textcolor{preprocessor}{}\textcolor{preprocessor}{\#include "{}xcerro.inc"{}}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00028}00028 \textcolor{preprocessor}{}      parameter(challe=\textcolor{stringliteral}{'XNTIMP'})}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00029}00029 \textcolor{comment}{* Locals}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00030}00030       \textcolor{keywordtype}{CHARACTER*11} XNELNA, CHELNA}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00031}00031       parameter(maxtms=1000000,mxttab=1+mxreac*nreinf)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00032}00032       dimension tmstor(maxtms), imttmp(mxttab,2)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00033}00033       \textcolor{keywordtype}{LOGICAL} LORDER}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00034}00034 \textcolor{comment}{*}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00035}00035 \textcolor{comment}{*-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00036}00036 \textcolor{comment}{*}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00037}00037 \textcolor{comment}{* -\/-\/-\/> Suppose we fail}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00038}00038       ipmat=0}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00039}00039 \textcolor{comment}{* -\/-\/-\/> Get rid of possible temperature code}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00040}00040       izaint=mod(izamat,10000000)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00041}00041       chelna=xnelna(izaint)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00042}00042 \textcolor{comment}{* -\/-\/-\/> Now check that wc can interpolate}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00043}00043       \textcolor{keywordflow}{IF}(ntemp.LE.0) \textcolor{keywordflow}{THEN}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00044}00044          cherro=\textcolor{stringliteral}{'Should have at least one temperature available'}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00045}00045          \textcolor{keyword}{CALL }xnerro(challe,cherro,\textcolor{stringliteral}{'E'})}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00046}00046          \textcolor{keywordflow}{GOTO} 999}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00047}00047       \textcolor{keywordflow}{ELSE}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00048}00048          \textcolor{keywordflow}{DO} ktemp=1,ntemp}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00049}00049             \textcolor{keywordflow}{IF}(itemp.EQ.ltempe(ktemp)) \textcolor{keywordflow}{THEN}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00050}00050 \textcolor{comment}{* -\/-\/-\/> Great, we found it in one of the temperatures available,}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00051}00051 \textcolor{comment}{*      nothing to do, just read it from disk}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00052}00052 \textcolor{comment}{* -\/-\/-\/> Make sure that the temperature code is loaded}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00053}00053                \textcolor{keyword}{CALL }xnctmp(itemp,kcode)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00054}00054                izatmp=kcode*10000000+izaint}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00055}00055                \textcolor{keyword}{CALL }xntabl(izatmp,0,ipmat)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00056}00056                \textcolor{keywordflow}{GOTO} 999}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00057}00057 \textcolor{keywordflow}{            ENDIF}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00058}00058 \textcolor{keywordflow}{         ENDDO}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00059}00059 \textcolor{keywordflow}{      ENDIF}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00060}00060 \textcolor{comment}{* -\/-\/-\/> So we come here, we have at least one temperature and we}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00061}00061 \textcolor{comment}{*      have to interpolate}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00062}00062 \textcolor{comment}{* -\/-\/-\/> Temperatures should be given in increasing order, check that}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00063}00063       lorder=.false.}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00064}00064       \textcolor{keywordflow}{DO} ktemp=1,ntemp-\/1}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00065}00065          \textcolor{keywordflow}{DO} jtemp=ktemp+1,ntemp}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00066}00066             \textcolor{keywordflow}{IF}(ltempe(ktemp).GT.ltempe(jtemp)) \textcolor{keywordflow}{THEN}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00067}00067                itmp=ltempe(ktemp)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00068}00068                ltempe(ktemp)=ltempe(jtemp)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00069}00069                ltempe(jtemp)=itmp}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00070}00070                lorder=.true.}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00071}00071 \textcolor{keywordflow}{            ENDIF}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00072}00072 \textcolor{keywordflow}{         ENDDO}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00073}00073 \textcolor{keywordflow}{      ENDDO}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00074}00074       \textcolor{keywordflow}{IF}(lorder) \textcolor{keywordflow}{THEN}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00075}00075 \textcolor{comment}{* -\/-\/-\/> If we had to order, issue a warning}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00076}00076          cherro=\textcolor{stringliteral}{'Temperature vector was not ordered,'}//}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00077}00077      +        \textcolor{stringliteral}{'we ordered it for you'}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00078}00078          \textcolor{keyword}{CALL }xnerro(challe,cherro,\textcolor{stringliteral}{'W'})}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00079}00079 \textcolor{keywordflow}{      ENDIF}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00080}00080       \textcolor{keywordflow}{IF}(itemp.LT.ltempe(1).OR.itemp.GT.ltempe(ntemp)) \textcolor{keywordflow}{THEN}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00081}00081 \textcolor{comment}{* -\/-\/-\/> Outside the limits, so we cannot interpolate and we do}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00082}00082 \textcolor{comment}{*      not want to try to be clever!}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00083}00083          \textcolor{keyword}{WRITE}(cherro,10000) itemp, ltempe(1), ltempe(ntemp)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00084}00084          \textcolor{keyword}{CALL }xnerro(challe,cherro,\textcolor{stringliteral}{'E'})}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00085}00085          \textcolor{keywordflow}{GOTO} 999}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00086}00086 \textcolor{keywordflow}{      ENDIF}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00087}00087 \textcolor{comment}{* -\/-\/-\/> Search interpolation range}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00088}00088       \textcolor{keywordflow}{DO} ktemp=2,ntemp}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00089}00089          \textcolor{keywordflow}{IF}(itemp.LT.ltempe(ktemp)) \textcolor{keywordflow}{THEN}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00090}00090             it1=ktemp-\/1}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00091}00091             it2=ktemp}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00092}00092             \textcolor{keywordflow}{GOTO} 10}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00093}00093 \textcolor{keywordflow}{         ENDIF}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00094}00094 \textcolor{keywordflow}{      ENDDO}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00095}00095       stop \textcolor{stringliteral}{'XNTIMP: Internal error 1'}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00096}00096    10 \textcolor{keywordflow}{CONTINUE}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00097}00097 \textcolor{comment}{* -\/-\/-\/> Now we get a temperature code for the requested temp}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00098}00098       \textcolor{keyword}{CALL }xnctmp(itemp,itcode)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00099}00099 \textcolor{comment}{* -\/-\/-\/> Let's see whether the work has already been done}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00100}00100       izanew=10000000*itcode+izaint}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00101}00101       \textcolor{keywordflow}{DO} imate=1,nmate}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00102}00102          \textcolor{keywordflow}{IF}(imtabl(1,imate).EQ.izanew) \textcolor{keywordflow}{THEN}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00103}00103             \textcolor{keyword}{WRITE}(cherro,10100) chelna,itemp}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00104}00104             \textcolor{keyword}{CALL }xnerro(challe,cherro,\textcolor{stringliteral}{'I'})}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00105}00105             \textcolor{keywordflow}{GOTO} 999}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00106}00106 \textcolor{keywordflow}{         ENDIF}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00107}00107 \textcolor{keywordflow}{      ENDDO}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00108}00108 \textcolor{comment}{* -\/-\/-\/> Get a code for the first temperature, temporarily}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00109}00109       ncold=nctemp}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00110}00110       \textcolor{keyword}{CALL }xnctmp(ltempe(it1),ic1)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00111}00111 \textcolor{comment}{* -\/-\/-\/> See whether the material is already in memory}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00112}00112 \textcolor{comment}{*      at temperature LTEMPE(IC1)}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00113}00113       jmate=0}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00114}00114       izait1=ic1*10000000+izaint}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00115}00115       \textcolor{keywordflow}{DO} imate=1,nmate}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00116}00116          \textcolor{keywordflow}{IF}(imtabl(1,imate).EQ.izait1) \textcolor{keywordflow}{THEN}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00117}00117 \textcolor{comment}{* -\/-\/-\/> Material is there, we just set it negative to mask it}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00118}00118             imtabl(1,imate)=-\/imtabl(1,imate)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00119}00119             jmate=imate}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00120}00120             \textcolor{keywordflow}{GOTO} 20}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00121}00121 \textcolor{keywordflow}{         ENDIF}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00122}00122 \textcolor{keywordflow}{      ENDDO}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00123}00123    20 \textcolor{keywordflow}{CONTINUE}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00124}00124 \textcolor{comment}{* -\/-\/-\/> Now we load the neutron spectra from first material}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00125}00125       cherro=\textcolor{stringliteral}{'Reading emitted spectra ...'}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00126}00126       \textcolor{keyword}{CALL }xnerro(challe,cherro,\textcolor{stringliteral}{'I'})}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00127}00127       \textcolor{keyword}{CALL }xntabl(izait1,5000,ipmat)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00128}00128       \textcolor{keywordflow}{IF}(ipmat.EQ.0) \textcolor{keywordflow}{THEN}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00129}00129          \textcolor{keyword}{WRITE}(cherro,10200) chelna,ltempe(it1)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00130}00130          \textcolor{keyword}{CALL }xnerro(challe,cherro,\textcolor{stringliteral}{'E'})}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00131}00131          \textcolor{keywordflow}{GOTO} 999}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00132}00132 \textcolor{keywordflow}{      ENDIF}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00133}00133 \textcolor{comment}{* -\/-\/-\/> And we correct it by hand!}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00134}00134       imtabl(1,nmate)=izanew}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00135}00135 \textcolor{comment}{* -\/-\/-\/> And we restore IZAIT1 if any}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00136}00136       \textcolor{keywordflow}{IF}(jmate.GT.0) \textcolor{keywordflow}{THEN}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00137}00137          imtabl(1,jmate)=-\/imtabl(1,jmate)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00138}00138 \textcolor{keywordflow}{      ENDIF}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00139}00139 \textcolor{comment}{* -\/-\/-\/> Reset the number of temperatures (maybe)}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00140}00140       nctemp=ncold}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00141}00141 \textcolor{comment}{* -\/-\/-\/> Ok, now open the first file and load index}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00142}00142       \textcolor{keyword}{WRITE}(cherro,10300) chelna,ltempe(it1)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00143}00143       \textcolor{keyword}{CALL }xnerro(challe,cherro,\textcolor{stringliteral}{'I'})}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00144}00144       \textcolor{keyword}{CALL }xntmpi(ltempe(it1))}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00145}00145       \textcolor{keyword}{CALL }xnopen}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00146}00146 \textcolor{comment}{* -\/-\/-\/> Load Cross sections}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00147}00147       iwmk=0}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00148}00148       \textcolor{keyword}{CALL }xnltmp(izaint,tmstor,maxtms,imttmp(1,1),mxttab,iwmk)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00149}00149 \textcolor{comment}{* -\/-\/-\/> Close Cross Sections database file}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00150}00150       \textcolor{keyword}{CALL }xnclos}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00151}00151 \textcolor{comment}{* -\/-\/-\/> We load the IMTTMP in place, the pointers are}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00152}00152 \textcolor{comment}{*      wrong, but the Q values are ok, as they do not depend}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00153}00153 \textcolor{comment}{*      on the temperature}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00154}00154       \textcolor{keywordflow}{DO} kinf=2,mxttab}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00155}00155          imtabl(kinf,nmate)=imttmp(kinf,1)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00156}00156 \textcolor{keywordflow}{      ENDDO}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00157}00157 \textcolor{comment}{* -\/-\/-\/> Open second file}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00158}00158       \textcolor{keyword}{WRITE}(cherro,10300) chelna,ltempe(it2)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00159}00159       \textcolor{keyword}{CALL }xnerro(challe,cherro,\textcolor{stringliteral}{'I'})}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00160}00160       \textcolor{keyword}{CALL }xntmpi(ltempe(it2))}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00161}00161       \textcolor{keyword}{CALL }xnopen}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00162}00162 \textcolor{comment}{* -\/-\/-\/> Load Cross sections}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00163}00163       \textcolor{keyword}{CALL }xnltmp(izaint,tmstor,maxtms,imttmp(1,2),mxttab,iwmk)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00164}00164 \textcolor{comment}{* -\/-\/-\/> Close Cross Sections database file}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00165}00165       \textcolor{keyword}{CALL }xnclos}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00166}00166 \textcolor{comment}{* -\/-\/-\/> Do the work}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00167}00167       \textcolor{keyword}{WRITE}(cherro,10400)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00168}00168       \textcolor{keyword}{CALL }xnerro(challe,cherro,\textcolor{stringliteral}{'I'})}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00169}00169       \textcolor{keyword}{CALL }xntemi(tmstor,maxtms,imttmp,ltempe(it1),ltempe(it2),itemp)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00170}00170 \textcolor{comment}{*}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00171}00171 10000 \textcolor{keyword}{FORMAT}(\textcolor{stringliteral}{'Temperature '},i4,\textcolor{stringliteral}{' outside interpolation limits '},}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00172}00172      +i4,\textcolor{stringliteral}{'-\/'},i4)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00173}00173 10100 \textcolor{keyword}{FORMAT}(a,\textcolor{stringliteral}{'@'},i4,\textcolor{stringliteral}{'K alrady in memory'})}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00174}00174 10200 \textcolor{keyword}{FORMAT}(\textcolor{stringliteral}{'Cannot load emitted spectra for '},a,\textcolor{stringliteral}{'@'},i4)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00175}00175 10300 \textcolor{keyword}{FORMAT}(\textcolor{stringliteral}{'Reading '},a,\textcolor{stringliteral}{'@'},i5,\textcolor{stringliteral}{'K'})}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00176}00176 10400 \textcolor{keyword}{FORMAT}(\textcolor{stringliteral}{'Interpolating values...'})}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00177}00177   999 \textcolor{keyword}{END}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00178}00178       \textcolor{keyword}{SUBROUTINE }xnerro(CHALLE,CHERRO,CHSEVE)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00179}00179 \textcolor{comment}{************************************************************************}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00180}00180 \textcolor{comment}{*                                                                      *}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00181}00181 \textcolor{comment}{*     Write messages to standard output                                *}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00182}00182 \textcolor{comment}{*                                                                      *}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00183}00183 \textcolor{comment}{*     CHALLE    (input) caller routine                                 *}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00184}00184 \textcolor{comment}{*                                                                      *}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00185}00185 \textcolor{comment}{*     CHERRO    (input) text of the error message                      *}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00186}00186 \textcolor{comment}{*                                                                      *}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00187}00187 \textcolor{comment}{*     CHSEVE    (input) lseverity level                                *}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00188}00188 \textcolor{comment}{*                                                                      *}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00189}00189 \textcolor{comment}{************************************************************************}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00190}00190       \textcolor{keywordtype}{CHARACTER*(*)} CHALLE,CHERRO}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00191}00191       \textcolor{keywordtype}{CHARACTER*1} CHSEVE}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00192}00192 \textcolor{comment}{*}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00193}00193 \textcolor{comment}{*-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00194}00194 \textcolor{comment}{*}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00195}00195       lcalle=lnblnk(challe)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00196}00196       lerror=lnblnk(cherro)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00197}00197       \textcolor{keyword}{WRITE}(6,\textcolor{stringliteral}{'('}\textcolor{stringliteral}{'?XN-\/'}\textcolor{stringliteral}{',A,'}\textcolor{stringliteral}{'-\/'}\textcolor{stringliteral}{',A,'}\textcolor{stringliteral}{': '}\textcolor{stringliteral}{',A)'}) chseve,challe(:lcalle)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00198}00198      +     ,cherro(:lerror)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00199}00199       \textcolor{keywordflow}{IF}(chseve.EQ.\textcolor{stringliteral}{'F'}) \textcolor{keywordflow}{THEN}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00200}00200          stop \textcolor{stringliteral}{'Fatal Error STOP in XNSECT'}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00201}00201 \textcolor{keywordflow}{      ENDIF}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00202}00202 \textcolor{comment}{*}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00203}00203       \textcolor{keyword}{END}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00204}00204       \textcolor{keyword}{SUBROUTINE }xnltmp(IZAINT,TMSTOR,MAXTMS,IMTTMP,MXTTAB,IWMK)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00205}00205 \textcolor{comment}{************************************************************************}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00206}00206 \textcolor{comment}{*                                                                      *}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00207}00207 \textcolor{comment}{*     Load cross sections in temporary storage to interpolate          *}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00208}00208 \textcolor{comment}{*     between different temperatures.                                  *}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00209}00209 \textcolor{comment}{*                                                                      *}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00210}00210 \textcolor{comment}{*     IZAINT    (input) material code for which the data are           *}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00211}00211 \textcolor{comment}{*               requested                                              *}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00212}00212 \textcolor{comment}{*                                                                      *}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00213}00213 \textcolor{comment}{*     TMSTOR    (output) array into which the cross sections are       *}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00214}00214 \textcolor{comment}{*               read                                                   *}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00215}00215 \textcolor{comment}{*                                                                      *}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00216}00216 \textcolor{comment}{*     MAXTMS    (input) dimension of TMSTOR                            *}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00217}00217 \textcolor{comment}{*                                                                      *}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00218}00218 \textcolor{comment}{*     IMTTMP    (output) array of pointers to cross section data,      *}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00219}00219 \textcolor{comment}{*               it has the same structure than IMTABL in common        *}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00220}00220 \textcolor{comment}{*               XCPOIN                                                 *}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00221}00221 \textcolor{comment}{*                                                                      *}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00222}00222 \textcolor{comment}{*     MXTTAB    (input) dimension of IMTTMP                            *}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00223}00223 \textcolor{comment}{*                                                                      *}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00224}00224 \textcolor{comment}{*     IWMK      (input) last word used in TMSTOR                       *}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00225}00225 \textcolor{comment}{*                                                                      *}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00226}00226 \textcolor{comment}{************************************************************************}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00227}00227 \textcolor{preprocessor}{\#include "{}xcmxse.inc"{}}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00228}00228 \textcolor{preprocessor}{}\textcolor{preprocessor}{\#include "{}xcutil.inc"{}}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00229}00229 \textcolor{preprocessor}{}\textcolor{preprocessor}{\#include "{}xcstor.inc"{}}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00230}00230 \textcolor{preprocessor}{}\textcolor{preprocessor}{\#include "{}xcpoin.inc"{}}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00231}00231 \textcolor{preprocessor}{}\textcolor{preprocessor}{\#include "{}xcdbas.inc"{}}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00232}00232 \textcolor{preprocessor}{}\textcolor{preprocessor}{\#include "{}xcindx.inc"{}}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00233}00233 \textcolor{preprocessor}{}\textcolor{preprocessor}{\#include "{}xcnamf.inc"{}}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00234}00234 \textcolor{preprocessor}{}\textcolor{preprocessor}{\#include "{}xcerro.inc"{}}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00235}00235 \textcolor{preprocessor}{}      parameter(challe=\textcolor{stringliteral}{'XNLTMP'})}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00236}00236       \textcolor{keywordtype}{CHARACTER*11} XNELNA,CHELNA}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00237}00237       dimension tmstor(maxtms), imttmp(mxttab)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00238}00238       dimension itr(nadinf),htr(nadinf)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00239}00239       equivalence(itr,htr)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00240}00240       \textcolor{keywordtype}{LOGICAL} LREAD}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00241}00241 \textcolor{comment}{*}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00242}00242 \textcolor{comment}{*-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00243}00243 \textcolor{comment}{*}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00244}00244 \textcolor{comment}{* -\/-\/-\/> Initialise IMTTMP}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00245}00245       imttmp(1)=izaint}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00246}00246       \textcolor{keywordflow}{DO} 10 jt=2,mxttab}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00247}00247          imttmp(jt) = 0}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00248}00248    10 \textcolor{keywordflow}{CONTINUE}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00249}00249 \textcolor{comment}{* -\/-\/-\/> Set read flag to false}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00250}00250       lread=.false.}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00251}00251 \textcolor{comment}{* -\/-\/-\/> Loop on all allowed reaction}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00252}00252       \textcolor{keywordflow}{DO} 50 ireac=1,mxreac}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00253}00253 \textcolor{comment}{* -\/-\/-\/> Build combined reaction code}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00254}00254          imt = nbmft(ireac)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00255}00255          imfmt = 3000+imt}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00256}00256          imttmp(1+nreinf*(ireac-\/1)+1) = iwmk}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00257}00257          \textcolor{keywordflow}{DO} 40 jindex=1,nindex/ninden}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00258}00258 \textcolor{comment}{* -\/-\/-\/> Scan Cross Section database index in search of reaction}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00259}00259             \textcolor{keywordflow}{IF}(izaint.EQ.lindex(1,jindex)) \textcolor{keywordflow}{THEN}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00260}00260 \textcolor{comment}{* -\/-\/-\/> Found isomer}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00261}00261                \textcolor{keywordflow}{IF}(imfmt.EQ.lindex(2,jindex)) \textcolor{keywordflow}{THEN}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00262}00262 \textcolor{comment}{* -\/-\/-\/> Found reaction, load data length}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00263}00263                   ilen = lindex(4,jindex)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00264}00264                   \textcolor{keywordflow}{IF}(ilen.GT.0) \textcolor{keywordflow}{THEN}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00265}00265 \textcolor{comment}{* -\/-\/-\/> Cross section is present, make sure we have enough space}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00266}00266                      \textcolor{keywordflow}{IF}(iwmk+ilen.LE.nbsize) \textcolor{keywordflow}{THEN}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00267}00267 \textcolor{comment}{* -\/-\/-\/> Cross section file, store number of pairs}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00268}00268                         imttmp(1+nreinf*(ireac-\/1)+2)=ilen/ 2}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00269}00269 \textcolor{comment}{* -\/-\/-\/> Number of words to read}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00270}00270                         ntodo=ilen}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00271}00271 \textcolor{comment}{* -\/-\/-\/> Record pointer in disk}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00272}00272                         nrecr=lindex(3,jindex)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00273}00273 \textcolor{comment}{* -\/-\/-\/> Last used position in memory}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00274}00274                         ipos =iwmk}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00275}00275 \textcolor{comment}{* -\/-\/-\/> Now read}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00276}00276 \textcolor{preprocessor}{\#ifdef XSASCII}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00277}00277 \textcolor{preprocessor}{}\textcolor{comment}{* -\/-\/-\/> Number of words per line}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00278}00278                         nwplin=6}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00279}00279 \textcolor{comment}{* -\/-\/-\/> Read header}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00280}00280                         \textcolor{keyword}{READ}(itape,rec=nrecr,fmt=10000) (htr(l),l=1}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00281}00281      \$                       ,nadinf)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00282}00282                         \textcolor{keywordflow}{DO} 20 l=1,nadinf}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00283}00283                            imttmp(1+nreinf*(ireac-\/1)+2+l)=itr(l)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00284}00284  20                     \textcolor{keywordflow}{CONTINUE}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00285}00285                         nrecr=nrecr+1}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00286}00286 \textcolor{comment}{* -\/-\/-\/> Read data}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00287}00287  30                     \textcolor{keyword}{READ}(itape,rec=nrecr,fmt=10000) (tmstor(ipos+l)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00288}00288      \$                       ,l=1,min(nwplin,ntodo))}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00289}00289 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00290}00290 \textcolor{preprocessor}{}\textcolor{comment}{* -\/-\/-\/> Number of words per line}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00291}00291                         nwplin=20}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00292}00292 \textcolor{comment}{* -\/-\/-\/> Read header}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00293}00293                         \textcolor{keyword}{READ}(itape,rec=nrecr) (htr(l),l=1,nadinf)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00294}00294                         \textcolor{keywordflow}{DO} 20 l=1,nadinf}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00295}00295                            imttmp(1+nreinf*(ireac-\/1)+2+l)=itr(l)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00296}00296  20                     \textcolor{keywordflow}{CONTINUE}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00297}00297                         nrecr=nrecr+1}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00298}00298 \textcolor{comment}{* -\/-\/-\/> Read data}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00299}00299  30                     \textcolor{keyword}{READ}(itape,rec=nrecr) (tmstor(ipos+l),l=1}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00300}00300      +                       ,min(nwplin,ntodo))}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00301}00301 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00302}00302 \textcolor{preprocessor}{}\textcolor{comment}{* -\/-\/-\/> Update counters}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00303}00303                         nrecr=nrecr+1}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00304}00304                         ntodo=ntodo-\/nwplin}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00305}00305                         ipos=ipos+nwplin}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00306}00306 \textcolor{comment}{* -\/-\/-\/> If not finished read again}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00307}00307                         \textcolor{keywordflow}{IF}(ntodo.GT.0) \textcolor{keywordflow}{GOTO} 30}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00308}00308 \textcolor{comment}{* -\/-\/-\/> Update High water Mark}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00309}00309                         iwmk = iwmk+ilen}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00310}00310 \textcolor{comment}{* -\/-\/-\/> Remember that we have read data}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00311}00311                         lread=.true.}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00312}00312                      \textcolor{keywordflow}{ELSE}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00313}00313 \textcolor{comment}{* -\/-\/-\/> No more space, print message}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00314}00314                         \textcolor{keyword}{WRITE}(cherro,10100)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00315}00315                         \textcolor{keyword}{CALL }xnerro(challe,cherro,\textcolor{stringliteral}{'E'})}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00316}00316 \textcolor{keywordflow}{                     ENDIF}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00317}00317 \textcolor{keywordflow}{                  ENDIF}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00318}00318 \textcolor{comment}{* -\/-\/-\/> This reaction is read, stop searching the disk index}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00319}00319                   \textcolor{keywordflow}{GOTO} 50}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00320}00320 \textcolor{keywordflow}{               ENDIF}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00321}00321 \textcolor{keywordflow}{            ENDIF}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00322}00322    40    \textcolor{keywordflow}{CONTINUE}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00323}00323    50 \textcolor{keywordflow}{CONTINUE}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00324}00324 \textcolor{comment}{* -\/-\/-\/> If we have read nothing, something is wrong!}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00325}00325       \textcolor{keywordflow}{IF}(.NOT.lread) \textcolor{keywordflow}{THEN}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00326}00326          chelna=xnelna(izaint)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00327}00327          \textcolor{keyword}{WRITE}(cherro,10200) chelna,}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00328}00328      +   chdbas(: index(chdbas,\textcolor{stringliteral}{' '})-\/1),chtemp(:index(chtemp,\textcolor{stringliteral}{' '})-\/1)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00329}00329          \textcolor{keyword}{CALL }xnerro(challe,cherro,\textcolor{stringliteral}{'E'})}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00330}00330 \textcolor{keywordflow}{      ENDIF}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00331}00331 \textcolor{comment}{*}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00332}00332 10000 \textcolor{keyword}{FORMAT}(6e11.4,i4,i2,i3,i5)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00333}00333 10100 \textcolor{keyword}{FORMAT}(\textcolor{stringliteral}{'No more space in the XCSTOR common'})}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00334}00334 10200 \textcolor{keyword}{FORMAT}(\textcolor{stringliteral}{'Could not find '},a,\textcolor{stringliteral}{' in file '},2a)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00335}00335   999 \textcolor{keyword}{END}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00336}00336       \textcolor{keyword}{SUBROUTINE }xntemi(TMSTOR,MAXTMS,IMTTMP,IT1,IT2,ITM)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00337}00337 \textcolor{comment}{************************************************************************}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00338}00338 \textcolor{comment}{*                                                                      *}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00339}00339 \textcolor{comment}{*     Interpolate cross sections between two different temperatures    *}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00340}00340 \textcolor{comment}{*                                                                      *}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00341}00341 \textcolor{comment}{*     TMSTOR    (input) array that contains the cross sections         *}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00342}00342 \textcolor{comment}{*                                                                      *}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00343}00343 \textcolor{comment}{*     MAXTMS    (input) dimension of TMSTOR                            *}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00344}00344 \textcolor{comment}{*                                                                      *}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00345}00345 \textcolor{comment}{*     IMTTMP    (input) array of pointers to cross section data,       *}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00346}00346 \textcolor{comment}{*               it has the same structure than IMTABL in common        *}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00347}00347 \textcolor{comment}{*               XCPOIN                                                 *}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00348}00348 \textcolor{comment}{*                                                                      *}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00349}00349 \textcolor{comment}{*     IT1       (input) first temperature in K                         *}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00350}00350 \textcolor{comment}{*                                                                      *}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00351}00351 \textcolor{comment}{*     IT2       (input) second temperature in K                        *}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00352}00352 \textcolor{comment}{*                                                                      *}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00353}00353 \textcolor{comment}{*     ITM       (input) temperature at which cross sections are        *}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00354}00354 \textcolor{comment}{*               requested: IT1<ITM<IT2                                 *}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00355}00355 \textcolor{comment}{*                                                                      *}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00356}00356 \textcolor{comment}{************************************************************************}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00357}00357 \textcolor{preprocessor}{\#include "{}xcmxse.inc"{}}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00358}00358 \textcolor{preprocessor}{}\textcolor{preprocessor}{\#include "{}xcpoin.inc"{}}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00359}00359 \textcolor{preprocessor}{}\textcolor{preprocessor}{\#include "{}xcstor.inc"{}}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00360}00360 \textcolor{preprocessor}{}\textcolor{preprocessor}{\#include "{}xcnamf.inc"{}}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00361}00361 \textcolor{preprocessor}{}\textcolor{preprocessor}{\#include "{}xcerro.inc"{}}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00362}00362 \textcolor{preprocessor}{}      parameter(challe=\textcolor{stringliteral}{'XNTEMI'})}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00363}00363       parameter(mxttab=1+mxreac*nreinf)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00364}00364       dimension tmstor(maxtms)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00365}00365       dimension imttmp(mxttab,2),ipoin(mxreac),ilim(mxreac),ibeg(mxreac)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00366}00366       dimension xsec(2),mreac(mxreac)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00367}00367       \textcolor{keywordtype}{LOGICAL} LEQUAL, LFOUND}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00368}00368 \#ifdef DXNTEMI}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00369}00369       \textcolor{keywordtype}{LOGICAL} LDEBUG}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00370}00370       parameter(ldebug=.true.)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00371}00371 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00372}00372 \textcolor{preprocessor}{}      parameter(hperc=0.01)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00373}00373       parameter(ninrea=35)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00374}00374       dimension lreac(ninrea),lconv(ninrea),secs(ninrea)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00375}00375 \textcolor{comment}{* -\/-\/-\/> Conversion between internal reaction representation and}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00376}00376 \textcolor{comment}{*      CHNAME, NBMFT arrays}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00377}00377       \textcolor{keyword}{DATA} lreac/ 1,  2,  3,  4,  5,  6, 48, 49, 50, 51, 52, 53, 54, 55,}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00378}00378      +           56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69,}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00379}00379      +           70, 71, 72, 73, 74, 75, 76 /}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00380}00380 \textcolor{comment}{*}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00381}00381 \textcolor{comment}{*-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00382}00382 \textcolor{comment}{*}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00383}00383 \textcolor{comment}{* -\/-\/-\/> Calculate the interpolation value}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00384}00384       trat=(real(it2)-\/itm)/(it2-\/it1)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00385}00385 \textcolor{comment}{* -\/-\/-\/> Load pointer to cross reactions so to leave total last}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00386}00386       \textcolor{keywordflow}{DO} 10 kr=2,mxreac}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00387}00387          mreac(kr-\/1)=kr}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00388}00388    10 \textcolor{keywordflow}{CONTINUE}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00389}00389       mreac(mxreac)=1}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00390}00390 \textcolor{comment}{* -\/-\/-\/> Loop on all reactions}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00391}00391       \textcolor{keywordflow}{DO} 100 kr=1,mxreac}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00392}00392          ireac=mreac(kr)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00393}00393          iprea=1+(ireac-\/1)*nreinf}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00394}00394 \textcolor{comment}{* -\/-\/-\/> See whether the reaction is there}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00395}00395          \textcolor{keywordflow}{IF}(imttmp(iprea+2,1).GT.0) \textcolor{keywordflow}{THEN}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00396}00396             \textcolor{keywordflow}{DO} 20 k=1,2}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00397}00397                ibeg(k)=imttmp(iprea+1,k)+1}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00398}00398                ipoin(k)=ibeg(k)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00399}00399                ilen=imttmp(iprea+2,k)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00400}00400                ilim(k)=ipoin(k)+2*ilen-\/1}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00401}00401    20       \textcolor{keywordflow}{CONTINUE}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00402}00402 \textcolor{comment}{* -\/-\/-\/> The reaction is there, make the union grid of energy}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00403}00403             ileng=0}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00404}00404 \textcolor{comment}{*}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00405}00405    30       emin=1e10}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00406}00406             lfound=.false.}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00407}00407 \textcolor{comment}{* -\/-\/-\/> Find next miminum energy between the two temperatures}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00408}00408             \textcolor{keywordflow}{DO} 40 k=1,2}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00409}00409                \textcolor{keywordflow}{IF}(ipoin(k).LE.ilim(k)) \textcolor{keywordflow}{THEN}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00410}00410                   emin=min(tmstor(ipoin(k)),emin)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00411}00411                   lfound=.true.}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00412}00412 \textcolor{keywordflow}{               ENDIF}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00413}00413    40       \textcolor{keywordflow}{CONTINUE}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00414}00414             \textcolor{keywordflow}{IF}(lfound) \textcolor{keywordflow}{THEN}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00415}00415 \textcolor{comment}{* -\/-\/-\/> Store it}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00416}00416                ileng=ileng+1}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00417}00417                xstore(ihgwmk+2*ileng-\/1)=emin}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00418}00418 \textcolor{comment}{* -\/-\/-\/> Update pointers and avoid duplicates}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00419}00419                \textcolor{keywordflow}{DO} 60 k=1,2}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00420}00420                   lequal=.false.}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00421}00421    50             \textcolor{keywordflow}{IF}(ipoin(k).LE.ilim(k)) \textcolor{keywordflow}{THEN}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00422}00422                      \textcolor{keywordflow}{IF}(emin.EQ.tmstor(ipoin(k))) \textcolor{keywordflow}{THEN}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00423}00423                         lequal=.true.}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00424}00424                         ipoin(k)=ipoin(k)+2}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00425}00425                         \textcolor{keywordflow}{GOTO} 50}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00426}00426 \textcolor{keywordflow}{                     ENDIF}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00427}00427 \textcolor{keywordflow}{                  ENDIF}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00428}00428                   \textcolor{keywordflow}{IF}(lequal) \textcolor{keywordflow}{THEN}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00429}00429 \textcolor{comment}{* -\/-\/-\/> Minimum energy was taken from this reaction, no need to}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00430}00430 \textcolor{comment}{*      interpolate}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00431}00431                      xsec(k)=tmstor(ipoin(k)-\/1)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00432}00432                   \textcolor{keywordflow}{ELSE}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00433}00433 \textcolor{comment}{* -\/-\/-\/> Do linear interpolation}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00434}00434                      \textcolor{keywordflow}{IF}(ipoin(k).EQ.ibeg(k)) \textcolor{keywordflow}{THEN}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00435}00435 \textcolor{comment}{* -\/-\/-\/> Energy must be less than minimum, take first cross section}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00436}00436                         xsec(k)=tmstor(ibeg(k)+1)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00437}00437                      \textcolor{keywordflow}{ELSEIF}(ipoin(k).GE.ilim(k)) \textcolor{keywordflow}{THEN}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00438}00438 \textcolor{comment}{* -\/-\/-\/> Energy is greater than maximum, take last cross section}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00439}00439                         xsec(k)=tmstor(ilim(k)+1)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00440}00440                      \textcolor{keywordflow}{ELSE}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00441}00441 \textcolor{comment}{* -\/-\/-\/> Perform linear interpolation to find cross section}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00442}00442                         xrat=(tmstor(ipoin(k))-\/emin)/(tmstor(ipoin(k))}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00443}00443      +                       -\/tmstor(ipoin(k)-\/2))}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00444}00444                         xsec(k)=tmstor(ipoin(k)-\/1)*xrat+tmstor(ipoin(k)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00445}00445      \$                       +1)*(1-\/xrat)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00446}00446 \textcolor{keywordflow}{                     ENDIF}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00447}00447 \textcolor{keywordflow}{                  ENDIF}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00448}00448    60          \textcolor{keywordflow}{CONTINUE}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00449}00449 \textcolor{comment}{* -\/-\/-\/> Interpolate with temperature to find cross section and}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00450}00450 \textcolor{comment}{*      store it in place}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00451}00451                xstore(ihgwmk+2*ileng)=xsec(1)*trat+xsec(2)*(1-\/trat)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00452}00452                \textcolor{keywordflow}{GOTO} 30}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00453}00453 \textcolor{keywordflow}{            ENDIF}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00454}00454 \textcolor{preprocessor}{\#ifdef DXNTEMI}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00455}00455 \textcolor{preprocessor}{}\textcolor{comment}{* Check Check Check Check Check Check Check Check Check Check Check Check}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00456}00456             \textcolor{keywordflow}{IF}(ldebug) \textcolor{keywordflow}{THEN}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00457}00457                \textcolor{keyword}{WRITE}(6,\textcolor{stringliteral}{'('}\textcolor{stringliteral}{'Checking reaction '}\textcolor{stringliteral}{',I4,'}\textcolor{stringliteral}{'...1'}\textcolor{stringliteral}{',\$)'}) ireac}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00458}00458 \textcolor{comment}{* Check that energies are in increasing order and not repeated}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00459}00459                \textcolor{keywordflow}{DO} jj=1,ileng-\/1}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00460}00460                   \textcolor{keywordflow}{IF}(xstore(ihgwmk+2*jj-\/1).GE.xstore(ihgwmk+2*jj+1))}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00461}00461      +                 \textcolor{keywordflow}{THEN}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00462}00462                      \textcolor{keyword}{WRITE}(6,\textcolor{stringliteral}{'('}\textcolor{stringliteral}{'Energies not in order after merge'}\textcolor{stringliteral}{')'})}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00463}00463                      stop}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00464}00464 \textcolor{keywordflow}{                  ENDIF}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00465}00465 \textcolor{keywordflow}{               ENDDO}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00466}00466 \textcolor{comment}{* Check that all points in the union are in either}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00467}00467                \textcolor{keyword}{WRITE}(6,\textcolor{stringliteral}{'('}\textcolor{stringliteral}{'...2'}\textcolor{stringliteral}{',\$)'})}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00468}00468                \textcolor{keywordflow}{DO} jj=1,ileng}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00469}00469                   ene=xstore(ihgwmk+2*jj-\/1)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00470}00470                   \textcolor{keywordflow}{DO} kk=1,2}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00471}00471                      \textcolor{keywordflow}{DO} ll=ibeg(kk),ilim(kk),2}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00472}00472                         \textcolor{keywordflow}{IF}(ene.EQ.tmstor(ll)) \textcolor{keywordflow}{GOTO} 80}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00473}00473                         \textcolor{keywordflow}{IF}(ene.LT.tmstor(ll)) \textcolor{keywordflow}{GOTO} 70}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00474}00474 \textcolor{keywordflow}{                     ENDDO}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00475}00475    70                \textcolor{keywordflow}{CONTINUE}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00476}00476 \textcolor{keywordflow}{                  ENDDO}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00477}00477                   \textcolor{keyword}{WRITE}(6,\textcolor{stringliteral}{'('}\textcolor{stringliteral}{'Energy '}\textcolor{stringliteral}{',G14.7,'}\textcolor{stringliteral}{' not in original'}\textcolor{stringliteral}{')'})}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00478}00478      +                 ene}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00479}00479    80             \textcolor{keywordflow}{CONTINUE}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00480}00480 \textcolor{keywordflow}{               ENDDO}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00481}00481 \textcolor{comment}{* Check that all points in the two ended up in the grid}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00482}00482                \textcolor{keyword}{WRITE}(6,\textcolor{stringliteral}{'('}\textcolor{stringliteral}{'...3'}\textcolor{stringliteral}{')'})}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00483}00483                \textcolor{keywordflow}{DO} kk=1,2}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00484}00484                   \textcolor{keywordflow}{DO} ll=ibeg(kk),ilim(kk),2}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00485}00485                      ene=tmstor(ll)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00486}00486                      \textcolor{keywordflow}{DO} jj=1,ileng}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00487}00487                         \textcolor{keywordflow}{IF}(ene.EQ.xstore(ihgwmk+2*jj-\/1)) \textcolor{keywordflow}{GOTO} 90}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00488}00488                         \textcolor{keywordflow}{IF}(ene.LT.xstore(ihgwmk+2*jj-\/1)) \textcolor{keywordflow}{THEN}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00489}00489                            \textcolor{keyword}{WRITE}(6,}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00490}00490      +             \textcolor{stringliteral}{'('}\textcolor{stringliteral}{'Energy '}\textcolor{stringliteral}{',G14.7,'}\textcolor{stringliteral}{' K='}\textcolor{stringliteral}{',I1,'}\textcolor{stringliteral}{' not in union'}\textcolor{stringliteral}{')'})}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00491}00491      +                          ene,kk}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00492}00492                            \textcolor{keywordflow}{GOTO} 90}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00493}00493 \textcolor{keywordflow}{                        ENDIF}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00494}00494 \textcolor{keywordflow}{                     ENDDO}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00495}00495    90                \textcolor{keywordflow}{CONTINUE}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00496}00496 \textcolor{keywordflow}{                  ENDDO}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00497}00497 \textcolor{keywordflow}{               ENDDO}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00498}00498 \textcolor{keywordflow}{            ENDIF}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00499}00499 \textcolor{comment}{* Check Check Check Check Check Check Check Check Check Check Check Check}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00500}00500 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00501}00501 \textcolor{preprocessor}{}\textcolor{comment}{* -\/-\/-\/> Now thin result, but do not thin total, it is useless, and}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00502}00502 \textcolor{comment}{*      do not thin (n,n') for consistency}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00503}00503             \textcolor{keywordflow}{IF}(ireac.NE.1.AND.ireac.NE.3) \textcolor{keywordflow}{THEN}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00504}00504                \textcolor{keyword}{CALL }xnthin(xstore(ihgwmk+1),ileng,inew,hperc)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00505}00505 \textcolor{preprocessor}{\#ifdef DXNTEMI}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00506}00506 \textcolor{preprocessor}{}               \textcolor{keywordflow}{IF}(ldebug) \textcolor{keywordflow}{THEN}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00507}00507                   \textcolor{keyword}{WRITE}(6,\textcolor{stringliteral}{'('}\textcolor{stringliteral}{'Thinning '}\textcolor{stringliteral}{',A,'}\textcolor{stringliteral}{' from '}\textcolor{stringliteral}{',I6,'}\textcolor{stringliteral}{' to '}\textcolor{stringliteral}{',I6)'})}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00508}00508      +                 chname(ireac),ileng,inew}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00509}00509 \textcolor{keywordflow}{               ENDIF}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00510}00510 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00511}00511 \textcolor{preprocessor}{}               ileng=inew}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00512}00512 \textcolor{keywordflow}{            ENDIF}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00513}00513          \textcolor{keywordflow}{ELSE}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00514}00514 \textcolor{comment}{* -\/-\/-\/> The reaction is not there, just set length to 0}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00515}00515             ileng=0}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00516}00516 \textcolor{keywordflow}{         ENDIF}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00517}00517 \textcolor{comment}{* -\/-\/-\/> Update the pointers}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00518}00518          imtabl(iprea+1,nmate)=ihgwmk}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00519}00519          imtabl(iprea+2,nmate)=ileng}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00520}00520          ihgwmk=ihgwmk+2*ileng}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00521}00521   100 \textcolor{keywordflow}{CONTINUE}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00522}00522 \textcolor{comment}{* -\/-\/-\/> In principle we have finished, but our total cross section is not}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00523}00523 \textcolor{comment}{*      a proper one. In order to have one we should build the union grid}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00524}00524 \textcolor{comment}{*      of all the energy points}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00525}00525 \textcolor{comment}{*}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00526}00526 \textcolor{comment}{* -\/-\/-\/> Store the pointers of all cross sections}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00527}00527       \textcolor{keywordflow}{DO} 110 k=1,ninrea}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00528}00528          kl=lreac(k)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00529}00529          ibeg(k)=imtabl(1+(kl-\/1)*nreinf+1,nmate)+1}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00530}00530          ilen=imtabl(1+(kl-\/1)*nreinf+2,nmate)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00531}00531          ipoin(k)=ibeg(k)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00532}00532          ilim(k)=ibeg(k)+2*ilen-\/2}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00533}00533   110 \textcolor{keywordflow}{CONTINUE}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00534}00534       ileng=0}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00535}00535 \textcolor{comment}{*}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00536}00536   120 emin=1e10}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00537}00537       lfound=.false.}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00538}00538 \textcolor{comment}{* -\/-\/-\/> Find miminum energy to add to our list}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00539}00539       \textcolor{keywordflow}{DO} 130 k=2,ninrea}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00540}00540          \textcolor{keywordflow}{IF}(ipoin(k).LE.ilim(k)) \textcolor{keywordflow}{THEN}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00541}00541             emin=min(xstore(ipoin(k)),emin)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00542}00542             lfound=.true.}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00543}00543 \textcolor{keywordflow}{         ENDIF}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00544}00544   130 \textcolor{keywordflow}{CONTINUE}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00545}00545 \textcolor{comment}{* -\/-\/-\/> If no minimum energy is found, then we have finished}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00546}00546       \textcolor{keywordflow}{IF}(lfound) \textcolor{keywordflow}{THEN}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00547}00547 \textcolor{comment}{* -\/-\/-\/> One more point to store, update pointer}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00548}00548          ileng=ileng+1}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00549}00549 \textcolor{comment}{* -\/-\/-\/> Store energy}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00550}00550          tmstor(2*ileng-\/1)=emin}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00551}00551 \textcolor{comment}{* -\/-\/-\/> Initialise sum to 0}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00552}00552          xsum=0}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00553}00553 \textcolor{comment}{* -\/-\/-\/> Loop on all reactions}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00554}00554          \textcolor{keywordflow}{DO} 150 k=2,ninrea}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00555}00555             \textcolor{keywordflow}{IF}(ibeg(k).LT.ilim(k)) \textcolor{keywordflow}{THEN}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00556}00556 \textcolor{comment}{* -\/-\/-\/> Reaction exists in database}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00557}00557                lequal=.false.}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00558}00558 \textcolor{comment}{* -\/-\/-\/> See if the point is in this reaction}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00559}00559   140          \textcolor{keywordflow}{IF}(ipoin(k).LE.ilim(k)) \textcolor{keywordflow}{THEN}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00560}00560                   \textcolor{keywordflow}{IF}(emin.EQ.xstore(ipoin(k))) \textcolor{keywordflow}{THEN}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00561}00561                      lequal=.true.}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00562}00562 \textcolor{comment}{* -\/-\/-\/> If yes test next point}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00563}00563                      ipoin(k)=ipoin(k)+2}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00564}00564                      \textcolor{keywordflow}{GOTO} 140}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00565}00565 \textcolor{keywordflow}{                  ENDIF}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00566}00566 \textcolor{comment}{* -\/-\/-\/> If the energy exists in the reaction,}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00567}00567 \textcolor{comment}{*      just add the value of the cross section}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00568}00568                   \textcolor{keywordflow}{IF}(lequal) \textcolor{keywordflow}{THEN}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00569}00569                      toadd=xstore(ipoin(k)-\/1)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00570}00570 \textcolor{comment}{* -\/-\/-\/> Else do linear interpolation}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00571}00571                   \textcolor{keywordflow}{ELSE}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00572}00572                      \textcolor{keywordflow}{IF}(ipoin(k).EQ.ibeg(k)) \textcolor{keywordflow}{THEN}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00573}00573 \textcolor{comment}{* -\/-\/-\/> Energy smaller than minimum, add first cross section}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00574}00574                         toadd=xstore(ibeg(k)+1)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00575}00575                      \textcolor{keywordflow}{ELSE}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00576}00576 \textcolor{comment}{* -\/-\/-\/> Perform linear interpolation}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00577}00577                         xrat=(xstore(ipoin(k))-\/emin)/(xstore(ipoin(k))}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00578}00578      +                       -\/xstore(ipoin(k)-\/2))}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00579}00579                         \textcolor{keywordflow}{IF}(emin.LT.xstore(ipoin(k)-\/2).OR.emin.gt}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00580}00580      +                       .xstore(ipoin(k))) \textcolor{keywordflow}{THEN}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00581}00581                            \textcolor{keyword}{WRITE}(cherro,10000) xstore(ipoin(k)-\/2),emin}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00582}00582      +                     ,xstore(ipoin(k))}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00583}00583                            \textcolor{keyword}{CALL }xnerro(challe,cherro,\textcolor{stringliteral}{'E'})}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00584}00584 \textcolor{keywordflow}{                        ENDIF}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00585}00585                         toadd=xstore(ipoin(k)-\/1)*xrat+xstore(ipoin(k)+1)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00586}00586      \$                       *(1-\/xrat)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00587}00587 \textcolor{keywordflow}{                     ENDIF}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00588}00588 \textcolor{keywordflow}{                  ENDIF}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00589}00589                \textcolor{keywordflow}{ELSE}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00590}00590 \textcolor{comment}{* -\/-\/-\/> Energy larger than maximum, add last cross section}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00591}00591                   toadd=xstore(ilim(k)+1)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00592}00592 \textcolor{keywordflow}{               ENDIF}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00593}00593 \textcolor{comment}{* -\/-\/-\/> Add contribution}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00594}00594                xsum=xsum+toadd}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00595}00595 \textcolor{keywordflow}{            ENDIF}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00596}00596   150    \textcolor{keywordflow}{CONTINUE}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00597}00597 \textcolor{comment}{* -\/-\/-\/> Store in place}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00598}00598          tmstor(2*ileng)=xsum}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00599}00599          \textcolor{keywordflow}{GOTO} 120}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00600}00600 \textcolor{keywordflow}{      ENDIF}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00601}00601 \textcolor{preprocessor}{\#ifdef DXNTEMI}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00602}00602 \textcolor{preprocessor}{}\textcolor{comment}{* Check Check Check Check Check Check Check Check Check Check Check Check}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00603}00603       \textcolor{keywordflow}{IF}(ldebug) \textcolor{keywordflow}{THEN}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00604}00604          \textcolor{keyword}{WRITE}(6,\textcolor{stringliteral}{'('}\textcolor{stringliteral}{'Checking total cross section '}\textcolor{stringliteral}{',\$)'})}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00605}00605          \textcolor{keyword}{WRITE}(6,\textcolor{stringliteral}{'('}\textcolor{stringliteral}{'...1'}\textcolor{stringliteral}{',\$)'})}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00606}00606 \textcolor{comment}{* Check that energies are in increasing order and not repeated}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00607}00607          \textcolor{keywordflow}{DO} jj=1,ileng-\/1}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00608}00608             \textcolor{keywordflow}{IF}(tmstor(2*jj-\/1).GE.tmstor(2*jj+1)) \textcolor{keywordflow}{THEN}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00609}00609                \textcolor{keyword}{WRITE}(6,\textcolor{stringliteral}{'('}\textcolor{stringliteral}{'Energies not in order after merge'}\textcolor{stringliteral}{')'})}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00610}00610                stop}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00611}00611 \textcolor{keywordflow}{            ENDIF}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00612}00612 \textcolor{keywordflow}{         ENDDO}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00613}00613 \textcolor{comment}{* Check that all points in the union are in either}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00614}00614          \textcolor{keyword}{WRITE}(6,\textcolor{stringliteral}{'('}\textcolor{stringliteral}{'...2'}\textcolor{stringliteral}{',\$)'})}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00615}00615          \textcolor{keywordflow}{DO} jj=1,ileng}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00616}00616             ene=tmstor(2*jj-\/1)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00617}00617             \textcolor{keywordflow}{DO} kk=2,ninrea}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00618}00618                \textcolor{keywordflow}{DO} ll=ibeg(kk),ilim(kk),2}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00619}00619                   \textcolor{keywordflow}{IF}(ene.EQ.xstore(ll)) \textcolor{keywordflow}{GOTO} 170}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00620}00620                   \textcolor{keywordflow}{IF}(ene.LT.xstore(ll)) \textcolor{keywordflow}{GOTO} 160}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00621}00621 \textcolor{keywordflow}{               ENDDO}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00622}00622   160          \textcolor{keywordflow}{CONTINUE}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00623}00623 \textcolor{keywordflow}{            ENDDO}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00624}00624             \textcolor{keyword}{WRITE}(6,\textcolor{stringliteral}{'('}\textcolor{stringliteral}{' Energy '}\textcolor{stringliteral}{',G14.7,'}\textcolor{stringliteral}{' not in original'}\textcolor{stringliteral}{')'}) ene}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00625}00625   170       \textcolor{keywordflow}{CONTINUE}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00626}00626 \textcolor{keywordflow}{         ENDDO}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00627}00627 \textcolor{comment}{* Check that all points in the two ended up in the grid}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00628}00628          \textcolor{keyword}{WRITE}(6,\textcolor{stringliteral}{'('}\textcolor{stringliteral}{'...3'}\textcolor{stringliteral}{',\$)'})}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00629}00629          \textcolor{keywordflow}{DO} kk=2,ninrea}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00630}00630             \textcolor{keywordflow}{DO} ll=ibeg(kk),ilim(kk),2}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00631}00631                ene=xstore(ll)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00632}00632                \textcolor{keywordflow}{DO} jj=1,ileng}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00633}00633                   \textcolor{keywordflow}{IF}(ene.EQ.tmstor(2*jj-\/1)) \textcolor{keywordflow}{GOTO} 180}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00634}00634                   \textcolor{keywordflow}{IF}(ene.LT.tmstor(2*jj-\/1)) \textcolor{keywordflow}{THEN}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00635}00635                      \textcolor{keyword}{WRITE}(6,}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00636}00636      +             \textcolor{stringliteral}{'('}\textcolor{stringliteral}{'Energy '}\textcolor{stringliteral}{',G14.7,'}\textcolor{stringliteral}{' K='}\textcolor{stringliteral}{',I1,'}\textcolor{stringliteral}{' not in total'}\textcolor{stringliteral}{')'})}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00637}00637      +                    ene,kk}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00638}00638                      \textcolor{keywordflow}{GOTO} 180}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00639}00639 \textcolor{keywordflow}{                  ENDIF}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00640}00640 \textcolor{keywordflow}{               ENDDO}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00641}00641   180          \textcolor{keywordflow}{CONTINUE}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00642}00642 \textcolor{keywordflow}{            ENDDO}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00643}00643 \textcolor{keywordflow}{         ENDDO}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00644}00644          \textcolor{keyword}{WRITE}(6,\textcolor{stringliteral}{'('}\textcolor{stringliteral}{'Interp tot '}\textcolor{stringliteral}{',I6,'}\textcolor{stringliteral}{' Built tot '}\textcolor{stringliteral}{',I6)'})}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00645}00645      +        imtabl(1+2,nmate),ileng}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00646}00646 \textcolor{keywordflow}{      ENDIF}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00647}00647 \textcolor{comment}{* Check Check Check Check Check Check Check Check Check Check Check Check}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00648}00648 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00649}00649 \textcolor{preprocessor}{}\textcolor{comment}{* Now build total cross section + exotica}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00650}00650       totdif=0}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00651}00651 \textcolor{comment}{* -\/-\/-\/> Pointer at the first energy of interpolated total cross section}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00652}00652       ipo=ibeg(1)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00653}00653 \textcolor{comment}{* -\/-\/-\/> Last word before interpolated total cross section in XSTORE}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00654}00654       itota=ipo-\/1}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00655}00655       \textcolor{keywordflow}{DO} jj=1,ileng}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00656}00656 \textcolor{comment}{* -\/-\/-\/> Pick next energy from built total cross section}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00657}00657          ene=tmstor(2*jj-\/1)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00658}00658          \textcolor{keywordflow}{DO} kk=ipo,ilim(1),2}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00659}00659 \textcolor{comment}{* -\/-\/-\/> Search it in the interpolated total cross section}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00660}00660             \textcolor{keywordflow}{IF}(ene.EQ.xstore(kk)) \textcolor{keywordflow}{THEN}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00661}00661 \textcolor{comment}{* -\/-\/-\/> Ok, it is there, store it in place}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00662}00662                xstore(itota+2*jj-\/1)=ene}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00663}00663 \textcolor{preprocessor}{\#ifdef DXNTEMI}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00664}00664 \textcolor{preprocessor}{}               \textcolor{keywordflow}{IF}(ldebug) \textcolor{keywordflow}{THEN}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00665}00665                   xsint=xstore(ipo+1)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00666}00666                   xsblt=tmstor(2*jj)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00667}00667                   \textcolor{keywordflow}{IF}(2*abs(xsblt-\/xsint)/(xsint+xsblt).GT.0.05) \textcolor{keywordflow}{THEN}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00668}00668                      \textcolor{keyword}{WRITE}(6}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00669}00669      +                    ,\textcolor{stringliteral}{'('}\textcolor{stringliteral}{'Ene '}\textcolor{stringliteral}{',G11.4,'}\textcolor{stringliteral}{' Interp '}\textcolor{stringliteral}{',G11.4,}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00670}00670 \textcolor{stringliteral}{}\textcolor{stringliteral}{     +                    '}\textcolor{stringliteral}{' Built '}\textcolor{stringliteral}{',G11.4,'}\textcolor{stringliteral}{' Delta '}\textcolor{stringliteral}{',G11.4)'}) ene}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00671}00671      +                    ,xstore(ipo+1),tmstor(2*jj),xstore(ipo+1)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00672}00672      +                    -\/tmstor(2*jj)}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00673}00673 \textcolor{keywordflow}{                  ENDIF}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00674}00674 \textcolor{keywordflow}{               ENDIF}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00675}00675 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00676}00676 \textcolor{preprocessor}{}\textcolor{comment}{* -\/-\/-\/> Store max between interpolated and calculated, to maintain}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00677}00677 \textcolor{comment}{*      consistency without losing exotica}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00678}00678                xstore(itota+2*jj)=max(xstore(ipo+1),tmstor(2*jj))}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00679}00679                ipo=kk+2}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00680}00680                \textcolor{keywordflow}{GOTO} 190}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00681}00681 \textcolor{keywordflow}{            ENDIF}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00682}00682             \textcolor{keywordflow}{IF}(ene.LT.xstore(kk)) \textcolor{keywordflow}{THEN}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00683}00683 \textcolor{comment}{* -\/-\/-\/> A proper total cross section should contain all the energies}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00684}00684 \textcolor{comment}{*      of all the constituents. The interpolated cross section has}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00685}00685 \textcolor{comment}{*      not been thinned, so it contains all the points of the two}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00686}00686 \textcolor{comment}{*      original cross sections. The calculated total cross section}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00687}00687 \textcolor{comment}{*      contains all the points of the original cross sections}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00688}00688 \textcolor{comment}{*      after thinning of partial reaction, so it should be a}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00689}00689 \textcolor{comment}{*      subset. If an energy in the calculated total cross section}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00690}00690 \textcolor{comment}{*      is not in the interpolated one, something is wrong, either}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00691}00691 \textcolor{comment}{*      this code or the starting total cross sections.}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00692}00692                \textcolor{keyword}{WRITE}(cherro,10100) ene}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00693}00693                \textcolor{keyword}{CALL }xnerro(challe,cherro,\textcolor{stringliteral}{'W'})}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00694}00694                \textcolor{keywordflow}{GOTO} 190}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00695}00695 \textcolor{keywordflow}{            ENDIF}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00696}00696 \textcolor{keywordflow}{         ENDDO}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00697}00697   190    \textcolor{keywordflow}{CONTINUE}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00698}00698 \textcolor{keywordflow}{      ENDDO}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00699}00699 \textcolor{comment}{* -\/-\/-\/> Work is finished, store length of new total cross section}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00700}00700       imtabl(1+2,nmate)=ileng}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00701}00701 \textcolor{comment}{*}}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00702}00702 10000 \textcolor{keyword}{FORMAT}(\textcolor{stringliteral}{'Error in linear interpolation: '},g14.7,\textcolor{stringliteral}{'<'},g14.7,\textcolor{stringliteral}{'<'},g14.7}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00703}00703      \$     ,\textcolor{stringliteral}{' ?'})}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00704}00704 10100 \textcolor{keyword}{FORMAT}(\textcolor{stringliteral}{' En '},g14.7,\textcolor{stringliteral}{' in inter but not in calculated'})}
\DoxyCodeLine{\Hypertarget{xntimp_8_f_source_l00705}00705       \textcolor{keyword}{END}}

\end{DoxyCode}
